<!DOCTYPE html>
<html>
<head>
	<title>Свояк — Таблица</title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no"/>
	<style type="text/css">
		/* DEBUG STYLES */
		table {
			/*border: 1px solid gray;*/
		}
		td {
			/*border: 1px solid gray;*/
		}


		* {
			font-family: Arial;
			padding: 0;
			margin: 0;
		}


		body {
			background: #f0f0f0;
		}


		table#main .avatar {
			min-width:	30px;
			min-height:	30px;
			max-width:	30px;
			max-height:	30px;
		}
		div#controls .avatar {
			min-width:	50px;
			min-height:	50px;
			max-width:	50px;
			max-height:	50px;
			margin: 5px;
		}

		.avatar {
			margin: 5px;
			border-radius: 5px;
		}
		.avatar.blue {
			background: #1191CE;
		}
		.avatar.red {
			background: #DA3B35;
		}
		.avatar.green {
			background: #84B73E;
		}
		.avatar.yellow {
			background: #EC9F01;
		}


		table#main {
			width: 100%;
			padding: 15px;
			margin-bottom: 350px;
		}
		table#main tr td:first-child {
			width: 10%;
			text-align: center;
		}
		table#main tr.score#current-question {
			background: #ccc
		}
		table#main tr.score#current-question td:first-child {
			border-top-left-radius: 5px;
			border-bottom-left-radius: 5px;
		}
		table#main tr.score#current-question td:last-child {
			border-top-right-radius: 5px;
			border-bottom-right-radius: 5px;
		}
		table#main tr th p {
			background: #555;
			color: white;
			padding: 10px;
			border-radius: 5px;
			margin-top: 20px;
		}
		table#main tr.score {
			line-height: 40px;
		}
		table#main tr.score td {
			text-align: center;
			font-weight: bold;
		}
		table#main tr.score[data-question] td {
			border-bottom: 1px solid #ccc;
		}
		table#main tr.score[data-question="4"] td {
			border-bottom: 3px double #ccc;
		}
		table#main tr.score td.positive {
			color: #84B73E;
		}
		table#main tr.score td.negative {
			color: #DA3B35;
		}


		div#controls {
			background: #aaa;
			position: fixed;
			bottom: 0;
			padding-bottom: 10px;
			width: 100%;
		}
		div#controls #navigation {
			margin: 20px 0;
		}
		div#controls #navigation button,
		div#controls #navigation span {
			font-size: 15px;
		}
		div#controls #navigation span {
			width: 100%;
			margin: 0 10px;
		}
		div#controls #navigation button {
			border: none;
			border-radius: 10px;
			background: white;
			padding: 10px;
			touch-action: manipulation;
		}
		div#controls table {
			table-layout: fixed;
			margin-bottom: 10px;
			width: 100%;
		}

		.action-buttons button {
			background: white;
			border: none;
			min-width: 50px;
			max-width: 50px;
			line-height: 50px;
			font-size: 40px;
			display: block;
			touch-action: manipulation;
		}
		.action-buttons button[data-type='plus'] {
			border-top-left-radius: 10px;
			border-top-right-radius: 10px;
			border-bottom: 1px solid #aaa;
			color: #84B73E;
		}
		.action-buttons button[data-type='clear'] {
			color: #999;
		}
		.action-buttons button[data-type='minus'] {
			border-bottom-left-radius: 10px;
			border-bottom-right-radius: 10px;
			border-top: 1px solid #aaa;
			color: #DA3B35;
		}

		/*.action-buttons button[data-type='plus']:hover {
			background: #e8f2d9;
		}
		.action-buttons button[data-type='clear']:hover {
			background: #ddd;
		}
		.action-buttons button[data-type='minus']:hover {
			background: #f7d5d4;
		}*/

		.action-buttons button[data-type='plus'].selected {
			background: #84B73E;
			color: white;
		}
		.action-buttons button[data-type='minus'].selected {
			background: #DA3B35;
			color: white;
		}
	</style>
	<script type="text/javascript">
		var score = [[], [], [], []]
		var subjectNumbers = 0

		function addSubject() {
			for (i = 0; i < 4; ++i) {
				score[i]
			}

			var subjectNumber = subjectNumbers++

			var table = document.getElementById("questions")

			var subjectHeader = document.createElement("tr")
			table.appendChild(subjectHeader)
			var td = document.createElement("th")
			td.setAttribute("colSpan", 5)
			subjectHeader.appendChild(td)
			var p = document.createElement("p")
			p.innerHTML = "Тема " + (subjectNumber+1)
			td.appendChild(p)

			for(question = 0; question < 5; ++question) {
				var tr = document.createElement("tr")
				tr.setAttribute("class", "score")
				tr.setAttribute("data-subject", subjectNumber)
				tr.setAttribute("data-question", question)
				tr.onclick = onRowClicked
				table.appendChild(tr)

				var td = document.createElement("td")
				tr.appendChild(td)
				td.innerHTML = (question + 1) * 10

				for(player = 0; player < 4; ++player) {
					var td = document.createElement("td")
					td.setAttribute("player", player)
					tr.appendChild(td)
				}
			}

			var totalRow = document.createElement("tr")
			totalRow.setAttribute("class", "score")
			table.appendChild(totalRow)
			var totalDescription = document.createElement("td")
			totalDescription.innerHTML = "Σ"
			totalRow.appendChild(totalDescription)

			for(player = 0; player < 4; ++player) {
				var td = document.createElement("td")
				totalRow.appendChild(td)
			}
		}

		function onRowClicked() {
			var currentRow = document.getElementById("current-question")
			if(currentRow != undefined) {
				currentRow.setAttribute("id", "")
			}

			this.setAttribute("id", "current-question")

			var subject = parseInt(this.getAttribute("data-subject"))
			var question = parseInt(this.getAttribute("data-question"))

			onCurrentQuestionChanged(subject, question)
		}

		function onActionAvatarClicked(element) {
			console.log("avatar selected", element)
			var avatar = element
			// avatar.setAttribute("class", avatar.getAttribute("class") + " selected")
		}

		function prevQuestion() {
			let currentRow = document.getElementById("current-question")
			if(currentRow == undefined) {
				return
			}

			let currentSubject = parseInt(currentRow.getAttribute("data-subject"))
			let currentQuestion = parseInt(currentRow.getAttribute("data-question"))

			let nextSubject = currentSubject - (currentQuestion == 0 ? 1 : 0)
			let nextQuestion = (5 + currentQuestion - 1) % 5

			selectQuestion(nextSubject, nextQuestion)
		}

		function nextQuestion() {
			let currentRow = document.getElementById("current-question")
			if(currentRow == undefined) {
				return
			}

			let currentSubject = parseInt(currentRow.getAttribute("data-subject"))
			let currentQuestion = parseInt(currentRow.getAttribute("data-question"))

			let nextSubject = currentSubject + (currentQuestion == 4 ? 1 : 0)
			let nextQuestion = (currentQuestion + 1) % 5

			if(nextSubject == subjectNumbers) {
				addSubject()
				window.scrollTo(0, document.body.scrollHeight);
			}

			selectQuestion(nextSubject, nextQuestion)
		}

		function selectQuestion(subject, question) {
			let currentRow = document.getElementById("current-question")

			let scoreTrs = document.getElementsByClassName("score")
			for(let i = 0; i < scoreTrs.length; ++i) {
				let scoreTr = scoreTrs[i]
				if(scoreTr.getAttribute("data-subject") == subject && scoreTr.getAttribute("data-question") == question) {
					currentRow.setAttribute("id", "")
					scoreTr.setAttribute("id", "current-question")
					onCurrentQuestionChanged(subject, question)
					break
				}
			}
		}

		function onCurrentQuestionChanged(subject, question) {
			var subjectName = (subject + 1)
			var questionName = (question + 1)*10

			var description = document.getElementById("current-question-description")
			description.innerHTML = "Тема " + subjectName + " — Вопрос за " + questionName
		}

		function assignRandomScores() {
			var scoreTrs = document.getElementsByClassName("score")
			for (i = 0; i < scoreTrs.length; ++i) {
				var scoreTr = scoreTrs[i]
				var playerTds = scoreTr.querySelectorAll('[player]')
				var question = (parseInt(scoreTr.getAttribute("data-question")) + 1)*10

				for(player = 0; player < playerTds.length; ++player) {
					var score = Math.random()
					var td = playerTds[player]
					if (score < 0.1) {
						td.innerHTML = "−" + question
						td.setAttribute("class", "negative")
					} else if (score < 0.2) {
						td.innerHTML = "+" + question
						td.setAttribute("class", "positive")
						break
					}
				}
			}
		}

		function onActionButtonClicked(button) {
			let selected = button.getAttribute("class") == "selected"
			if (selected) {
				return
			}
			button.setAttribute("class", "selected")
			console.log("Selected")

			let siblings = button.parentNode.childNodes
			for(let i = 0; i < siblings.length; ++i) {
				let sibling = siblings[i]
				if(sibling != button && sibling.nodeType == 1) {
					sibling.setAttribute("class", "")
				}
			}
		}

		setTimeout(addSubject, 100)
		setTimeout(addSubject, 200)
		setTimeout(addSubject, 200)
		setTimeout(addSubject, 200)
		setTimeout(addSubject, 200)

		setTimeout(assignRandomScores, 300)
	</script>
</head>
<body>
	<table id="main" cellspacing="0">
		<tbody id="questions">
		</tbody>
		<tbody id="avatars">
			<tr>
				<td></td>
				<td align="center"><div class="avatar red"> </div><p>Игрок 1</p></td>
				<td align="center"><div class="avatar blue"> </div><p>Игрок 2</p></td>
				<td align="center"><div class="avatar yellow"> </div><p>Игрок 3</p></td>
				<td align="center"><div class="avatar green"> </div><p>Игрок 4</p></td>
			</tr>
		</tbody>
	</table>

	<div id="controls">
		<div id="navigation" align="center">
			<button onclick="prevQuestion()">
				Назад
			</button>
			<span id="current-question-description">
				Текущий вопрос
			</span>
			<button onclick="nextQuestion()">
				Вперед
			</button>
		</div>
		<table>
			<tr>
				<td align="center">
					<div class="action-buttons">
						<button onclick="onActionButtonClicked(this)" data-player="0" data-type="plus">+</button>
						<button onclick="onActionButtonClicked(this)" data-player="0" data-type="clear">0</button>
						<button onclick="onActionButtonClicked(this)" data-player="0" data-type="minus">−</button>
					</div>
				</td>
				<td align="center">
					<div class="action-buttons">
						<button onclick="onActionButtonClicked(this)" data-player="1" data-type="plus">+</button>
						<button onclick="onActionButtonClicked(this)" data-player="1" data-type="clear">0</button>
						<button onclick="onActionButtonClicked(this)" data-player="1" data-type="minus">−</button>
					</div>
				</td>
				<td align="center">
					<div class="action-buttons">
						<button onclick="onActionButtonClicked(this)" data-player="2" data-type="plus">+</button>
						<button onclick="onActionButtonClicked(this)" data-player="2" data-type="clear">0</button>
						<button onclick="onActionButtonClicked(this)" data-player="2" data-type="minus">−</button>
					</div>
				</td>
				<td align="center">
					<div class="action-buttons">
						<button onclick="onActionButtonClicked(this)" data-player="3" data-type="plus">+</button>
						<button onclick="onActionButtonClicked(this)" data-player="3" data-type="clear">0</button>
						<button onclick="onActionButtonClicked(this)" data-player="3" data-type="minus">−</button>
					</div>
				</td>
			</tr>
		</table>
	</div>
</body>
</html>
























